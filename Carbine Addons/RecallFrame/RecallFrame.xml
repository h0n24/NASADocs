<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<Forms>
    <Form Class="Window" LAnchorPoint="ActionBar0_Left" LAnchorOffset="85" TAnchorPoint="ActionBar0_Top" TAnchorOffset="11" RAnchorPoint="ActionBar0_Left" RAnchorOffset="186" BAnchorPoint="ActionBar0_Top" BAnchorOffset="87" RelativeToClient="1" Font="Default" Text="" Template="" Name="RecallFrameForm" SwallowMouseClicks="1" BGColor="ffffffff" TextColor="ffffffff" TextId="" TooltipColor="" Tooltip="" LeftEdgeControlsAnchor="" TopEdgeControlsAnchor="" IgnoreMouse="1" NoClip="1" NeverBringToFront="1" TooltipType="OnCursor">
        <Control Class="Button" Base="HUD_BottomBar:btn_HUD_Recall" Font="Thick" ButtonType="Check" RadioGroup="" LAnchorPoint="0" LAnchorOffset="0" TAnchorPoint="0" TAnchorOffset="0" RAnchorPoint="1" RAnchorOffset="0" BAnchorPoint="1" BAnchorOffset="0" DT_VCENTER="1" DT_CENTER="1" TooltipType="OnCursor" Name="RecallOptionToggle" BGColor="ffffffff" TextColor="ffffffff" TooltipColor="" NormalTextColor="ffffffff" PressedTextColor="ffffffff" FlybyTextColor="ffffffff" PressedFlybyTextColor="ffffffff" DisabledTextColor="ffffffff" NewWindowDepth="1">
            <Event Name="ButtonCheck" Function="OnRecallOptionToggle"/>
            <Event Name="ButtonUncheck" Function="OnRecallOptionToggle"/>
        </Control>
        <Control Class="ActionBarButton" Name="RecallActionBtn" ContentType="GCBar" ContentId="18" Base="Button_ActionBarBlank" RelativeToClient="1" IfHoldNoSignal="1" DT_VCENTER="1" DT_CENTER="1" NeverBringToFront="1" Picture="0" WindowSoundTemplate="ActionBarButton" BGColor="ffffffff" TextColor="ffffffff" LAnchorPoint="0" LAnchorOffset="43" TAnchorPoint="0" TAnchorOffset="18" RAnchorPoint="0" RAnchorOffset="83" BAnchorPoint="0" BAnchorOffset="74" Font="CRB_InterfaceLarge_O" IgnoreTooltipDelay="1" TooltipColor="" NewControlDepth="10" HideInEditor="0" RechargeBarLAnchorPoint="1" RechargeBarLAnchorOffset="-8" RechargeBarTAnchorPoint="0" RechargeBarTAnchorOffset="4" RechargeBarRAnchorPoint="1" RechargeBarRAnchorOffset="4" RechargeBarBAnchorPoint="1" RechargeBarBAnchorOffset="-14" RechargeBarEmptyColorAttribute="Black" RechargeBarFullColorAttribute="ffffffff" RechargeBarEmptyAttribute="WhiteFill" RechargeBarFullAttribute="spr_HUD_VerticalGoo_Pulse" TooltipType="OnCursor" DrawHotkey="1" CheckboxRight="0" DrawShortcutBottom="1" UseBaseButtonArt="0">
            <Event Name="GenerateTooltip" Function="OnGenerateTooltip"/>
        </Control>
    </Form>
    <Form Class="Window" LAnchorPoint="0" LAnchorOffset="0" TAnchorPoint="0" TAnchorOffset="0" RAnchorPoint="0" RAnchorOffset="62" BAnchorPoint="0" BAnchorOffset="62" RelativeToClient="1" Font="Default" Text="" Template="Default" TooltipType="OnCursor" Name="RecallEntry" Border="0" Picture="1" SwallowMouseClicks="1" Moveable="0" Escapable="0" Overlapped="1" BGColor="ffffffff" TextColor="ffffffff" TooltipColor="" Tooltip="" Sprite="" RightEdgeControlsAnchor="">
        <Control Class="ActionBarButton" Name="RecallActionBtn" ContentType="GCBar" ContentId="18" Base="Button_ActionBarBlank" RelativeToClient="1" IfHoldNoSignal="1" DT_VCENTER="1" DT_CENTER="1" NeverBringToFront="1" Picture="0" WindowSoundTemplate="ActionBarButton" BGColor="ffffffff" TextColor="ffffffff" LAnchorPoint="0" LAnchorOffset="3" TAnchorPoint="0" TAnchorOffset="6" RAnchorPoint="1" RAnchorOffset="-3" BAnchorPoint="1" BAnchorOffset="-6" Font="CRB_InterfaceLarge_O" IgnoreTooltipDelay="1" TooltipColor="" NewControlDepth="10" HideInEditor="0" RechargeBarLAnchorPoint="1" RechargeBarLAnchorOffset="-8" RechargeBarTAnchorPoint="0" RechargeBarTAnchorOffset="4" RechargeBarRAnchorPoint="1" RechargeBarRAnchorOffset="4" RechargeBarBAnchorPoint="1" RechargeBarBAnchorOffset="-14" RechargeBarEmptyColorAttribute="Black" RechargeBarFullColorAttribute="ffffffff" RechargeBarEmptyAttribute="WhiteFill" RechargeBarFullAttribute="spr_HUD_VerticalGoo_Pulse" Text="" TooltipType="OnCursor">
            <Event Name="GenerateTooltip" Function="OnGenerateTooltip"/>
            <Event Name="ButtonSignal" Function="OnRecallBtn"/>
        </Control>
        <Pixie LAnchorPoint="0" LAnchorOffset="0" TAnchorPoint="0" TAnchorOffset="3" RAnchorPoint="1" RAnchorOffset="0" BAnchorPoint="1" BAnchorOffset="-3" Sprite="HUD_BottomBar:spr_HUD_BottomBar_SecondaryActionSlot" BGColor="white" TextColor="black" Rotation="0" Font="Default"/>
    </Form>
    <Form Class="Window" LAnchorPoint="ActionBar0_Left" LAnchorOffset="69" TAnchorPoint="ActionBar0_Top" TAnchorOffset="-214" RAnchorPoint="ActionBar0_Left" RAnchorOffset="227" BAnchorPoint="ActionBar0_Top" BAnchorOffset="46" RelativeToClient="1" Font="Default" Text="" Template="Default" TooltipType="OnCursor" Name="RecallSelectionMenu" BGColor="ffffffff" TextColor="ffffffff" TooltipColor="" IgnoreMouse="1" NoClip="1" CloseOnExternalClick="1" Overlapped="0" NewWindowDepth="1" Escapable="1" Picture="1" Sprite="BK3:sprHolo_Alert_Flyout" Tooltip="">
        <Control Class="Window" LAnchorPoint="0" LAnchorOffset="42" TAnchorPoint="0" TAnchorOffset="42" RAnchorPoint="1" RAnchorOffset="-42" BAnchorPoint="1" BAnchorOffset="-42" RelativeToClient="1" Font="Default" Text="" BGColor="UI_WindowBGDefault" TextColor="UI_WindowTextDefault" Template="Default" TooltipType="OnCursor" Name="Window" TooltipColor="" Sprite="UI_BK3_Holo_InsetSimple" Picture="1" IgnoreMouse="1" Tooltip=""/>
        <Control Class="Window" LAnchorPoint="0" LAnchorOffset="48" TAnchorPoint="0" TAnchorOffset="48" RAnchorPoint="1" RAnchorOffset="-48" BAnchorPoint="1" BAnchorOffset="-48" RelativeToClient="1" Font="Default" Text="" Template="Default" TooltipType="OnCursor" Name="Content" BGColor="ffffffff" TextColor="ffffffff" TooltipColor="" Picture="0" IgnoreMouse="1" Sprite="" NewControlDepth="14"/>
    </Form>
</Forms>
ecallActionBtn"):SetContentId(GameLib.CodeEnumRecallCommand.Warplot)
		elseif GameLib.GetDefaultRecallCommand() == GameLib.CodeEnumRecallCommand.Illium then
			bShowRecallBtn = true
			self.wndMain:FindChild("RecallActionBtn"):SetContentId(GameLib.CodeEnumRecallCommand.Illium)
		elseif GameLib.GetDefaultRecallCommand() == GameLib.CodeEnumRecallCommand.Thayd then
			bShowRecallBtn = true
			self.wndMain:FindChild("RecallActionBtn"):SetContentId(GameLib.CodeEnumRecallCommand.Thayd)
		end
	else
		bShowRecallBtn = false
	end
	
	if bShowRecallBtn then
		--Toggle Visibility based on ui preference
		local unitPlayer = GameLib.GetPlayerUnit()
		local nVisibility = Apollo.GetConsoleVariable("hud.SkillsBarDisplay")
		
		if nVisibility == 2 then --always off
			self.wndMain:Show(false)
		elseif nVisibility == 3 then --on in combat
			self.wndMain:Show(unitPlayer:IsInCombat())	
		elseif nVisibility == 4 then --on out of combat
			self.wndMain:Show(not unitPlayer:IsInCombat())
		else
			self.wndMain:Show(true)
		end
	else
		self.wndMain:Show(bShowRecallBtn)
	end
end

function RecallFrame:ResetDefaultCommand()
	local bHasWarplot = false
	-- Determine if this player is in a WarParty
	for key, guildCurr in pairs(GuildLib.GetGuilds()) do
		if guildCurr:GetType() == GuildLib.GuildType_WarParty then
			bHasWarplot = true
			break
		end
	end
	
	local bHasIllium = false
	local bHasThyad = false
	for idx, tSpell in pairs(AbilityBook.GetAbilitiesList(Spell.CodeEnumSpellTag.Misc) or {}) do
		if tSpell.bIsActive and tSpell.nId == GameLib.GetTeleportThaydSpell():GetBaseSpellId() then
			bHasThyad = true
		end
		if tSpell.bIsActive and tSpell.nId == GameLib.GetTeleportIlliumSpell():GetBaseSpellId() then
			bHasIllium = true
		end
	end

	if GameLib.HasBindPoint() then 	
		GameLib.SetDefaultRecallCommand(GameLib.CodeEnumRecallCommand.BindPoint)
	elseif HousingLib.IsResidenceOwner() == true then
		GameLib.SetDefaultRecallCommand(GameLib.CodeEnumRecallCommand.House)	
	elseif bHasWarplot then
		GameLib.SetDefaultRecallCommand(GameLib.CodeEnumRecallCommand.Warplot)
	elseif bHasIllium then
		GameLib.SetDefaultRecallCommand(GameLib.CodeEnumRecallCommand.Illium)
	elseif bHasThyad then
		GameLib.SetDefaultRecallCommand(GameLib.CodeEnumRecallCommand.Thayd)
	else
		GameLib.SetDefaultRecallCommand(GameLib.CodeEnumRecallCommand.